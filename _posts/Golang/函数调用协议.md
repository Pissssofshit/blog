---
layout: post
title: 函数调用协议
categories: [Golang]
tags: [Golang]
---

## 虚拟地址空间

函数参数
函数返回地址
调用者bp
局部变量
返回值(由右至左)

栈、堆、数据段(全局变量）、代码段

函数栈帧布局 :
调用者栈基地址
局部变量
返回值 (由右至左，给调用函数的)
参数(由右至左，给调用函数的)

返回值
函数参数
返回地址
函数栈帧

defer 

栈基：bp
栈顶：sp
指令寄存器：ip（是指向代码段中的指令）

指令寄存器中的值指向代码段中的指令

### 实现跳转与返回

call :
1. 将下一条指令入栈（返回地址）
2. 跳转到被调用函数入口处

ret : 
1. pop
2. 设置ip到对应地址

简单来说
函数通过call指令跳转
函数开始前会分配栈帧
结束时会恢复栈帧（恢复调用者栈基、恢复sp)
ret 恢复ip指令位置
参考资料

[1]https://www.tenouk.com/Bufferoverflowc/Bufferoverflow2a.html
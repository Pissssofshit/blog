[TOC]

## CAP说了什么
一个分布式系统不可能同时满足**数据一致性、服务可用性和分区容错性**这三个基本需求，最多只能同时满足其中的两个

## 一致性（ C ）
CAP 理论中的一致性是指强一致性（ Strong Consistency ），又叫线性一致性（ Linearizable Consistency ），它要求多节点组成的分布式系统，能像单节点一样运作，如果一个写操作返回成功，那么之后的读请求都必须读到这个新数据；如果返回失败，那么所有的读操作都不能读到这个数据。一致性中除了强一致性之外，还有其他的一致性级别，比如序列一致性（ Sequential Consistency ）和最终一致性（ Eventual Consistency ）等，这个在后面的课程“一致性与共识（一）”中会有详细的介绍。

## 可用性（ A ）
CAP 理论对可用性的定义，指的是要求系统提供的服务必须处于 100% 可用的状态，对于用户的每一个操作请求，系统总能够在有限的时间内返回结果。下面我们重点来讨论可用性定义中的三个关键点：“ 100% 可用”、“有限时间内”和“返回结果”。

## 分区容错性（ P ）
分区指的是在整个分布式系统中，因为各种网络原因，系统被分隔成多个单独的部分，它不仅包含我们通常说的网络分区，也包含因为网络丢包导致的网络不通的情况。并且，这里说的因为网络丢包导致网络不通的情形，还包含节点宕机的场景，由于系统的其他机器不知道某个节点宕机了，只知道与宕机节点的网络是不通的，所以当节点宕机发生时，其他节点发往宕机节点的包也将丢失。在现实的分布式系统中，我们面对的就是一个不可靠的网络和有一定概率宕机的设备，这两个因素都会导致分区出现，因此在分布式系统实现中，分区容错性 P 是一个必须项，而不是可选项。在分布式系统中，如果我们的设计放弃分区容错性，就相当于我们认为节点之间的网络通信永远是好的，那么我们对节点之间的远程调用的结果，就不需要处理超时、网络地址不可达等网络层错误了。但是这样一来，看似是简化了系统设计，实际却忽视了超时等网络错误的情况。当它们出现后，系统的行为就是未定义的了，可能会出现崩溃，或者是脏数据的问题。因此，对于分布式系统工程实践来说， CAP 理论更合适的描述是：在满足分区容错的前提下，没有算法能同时满足数据一致性和服务可用性。


## 为什么
如zk 强一致性（每次写入都要同步到所有节点)，但降低了可用性（因为频繁写降低了性能)
如etcd 高可用性（怎么达到的呢？)


## 小结
1 一致性 （C）一致性级别 是 从高到低
     1.1 强一致性
     1.2 单调一致性
     1.3 会话一致性
     1.4 序列一致性
     1.5 最终一致性
2 可用性 （A）
       关键字： 100%可用 有限时间内 返回结果
3 分区容错性 （P）
      3.1 网络分区
      3.2 网络丢包导致的网络不通 （包含节点宕机）

## 资料
[03｜CAP 理论：分布式场景下我们真的只能三选二吗？](https://time.geekbang.org/column/article/481069)
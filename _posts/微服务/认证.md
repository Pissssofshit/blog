## OAuth2
### 什么是OA
OAuth2 是当前授权的行业标准，其重点在于为 Web 应用程序、桌面应用程序、移动设备以及室内设备的授权流程提供简单的客户端开发方式。它为第三方应用提供对 HTTP 服务的有限访问，既可以是资源拥有者通过授权允许第三方应用获取 HTTP 服务，也可以是第三方应用以自己的名义获取访问权限。
### 角色
### 流程
1. 客户端将资源所有者的代理重定向到授权服务器的端点。客户端会在重定向的地址中提交自身的客户端标识、请求范围、本地状态和用于接收授权码的重定向地址等信息

2. 资源所有者通过代理与授权服务器直接交互，授权服务器认证资源所有者的身份，并确认资源所有者同意还是拒绝访问授权。

3. 在资源所有者同意授予客户端访问权限后，授权服务器会回调客户端在第一步中提交的重定向地址，并在重定向地址中携带生成的授权码和原先提交的本地状态。否则直接返回资源所有者拒绝授权。

4. 获取到授权码的客户端可以携带授权码和用于获取授权码的重定向地址，向授权服务器请求访问令牌。授权服务器会对客户端身份和授权码同时进行认证。

5. 授权服务器认证客户端身份和授权码，并对客户端提交的重定向地址和获取授权码的重定向地址进行匹配。如果信息一致，则返回访问令牌，并有可能同时返回刷新令牌

## JWT
### JWT是什么
JWT（JSON Web Token）作为一个开放的标准，通过紧凑（快速传输，体积小）并且自包含（有效负载中包含用户所需的所有信息，避免了对数据库的多次查询）的方式，定义了用于在各方之间发送的安全 JSON 对象。

JWT 可以很好地充当 OAuth2 的访问令牌和刷新令牌的载体，这是 Web 双方之间进行安全传输信息的良好方式。当只有授权服务器持有签发和验证 JWT 的 secret 时，也就只有授权服务器能验证 JWT 的有效性以及签发带有签名的 JWT，这就保证了以 JWT 为载体的 Token 的有效性和安全性。

### JWT的构成
它由 3 部分组成，每部分通过“.”分隔开，分别是：Header（头部）、Payload（有效负载）和Signature（签名）。

#### 头部
头部通常由两部分组成。
typ：类型，一般为 JWT。
alg：加密算法，通常是 HMAC SHA256 或者 RSA。

一个简单的头部例子如下：
```
{
	"alg": "HS256"
	"typ": "JWT"
}
```
这部分 JSON 数据会使用 Base64Url 编码后，用于构成 JWT 的第一部分，如下所示：
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
```

#### 载荷
有效负载是 JWT 的第二部分，是用来携带有效信息的载体，主要是关于用户实体和附加元数据的声明，由以下 3 部分组成。

Registered claims：注册声明。它是 JWT 预定的声明，但通常不要求强制使用。主要包含 iss（JWT 签发者）、exp（JWT 过期时间）、sub（JWT 面向的用户）、aud（接受 JWT 的一方）等属性信息。

Public claims：公开声明。在公开声明中可以添加任何信息，一般是用户信息或者业务扩展信息等。

Private claims：私有声明。它是由 JWT 提供者和消费者共同定义的声明，既不属于注册声明也不属于公开声明。

Base64 对称解密的方式很容易使得加密信息被还原，所以一般不建议在 Payload 中添加任何的敏感信息。

一个简单的有效负载例子，如下：
```
{
  "sub": "1234567890",
  	"name": "xuan",
  	"exp": 1518051157
}
```

这部分 JSON 会使用 Base64Url 编码后，用于构成 JWT 的第二部分，如下所示：

```
eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6Inh1YW4iLCJleHAiOjE1MTgwNTExNTd9
```

> 如此的话，Payload不是很容易被截获并解密吗 (jwt token 只是一个凭证，用来校验你这个东西确实是服务器发放的认证，payload里的东西也是无关紧要的)


### Signature（签名）
要创建签名，就必须要有被编码后的头部、被编码后的有效负载以及一个 secret，最后通过在头部定义的加密算法 alg 加密生成签名。生成签名的伪代码如下：

```
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret)
```
上述伪代码中使用的加密算法为 HMACSHA256。Secret 作为签发密钥，用于验证 JWT 以及签发 JWT，所以只能由服务端持有，不该泄漏出去。

一个简单的签名如下，这就是 JWT 的第三部分。

```
X36pDQoYydHv7KDCiltTBKcQbt-iIT-jFgmUjkTSCxE
```
如上所述的三个部分通过“.”分割，就组成最终的 JWT。

### JWT 实现单点登录
### JWT 
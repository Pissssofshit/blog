## 分析技术
explain
## 业务场景
### 优化
#### join
分析慢查日志，其中有一大部分用到了join,使用explain 分析发现用到的算法是BNL，效率较低
* 发现使用到了left join ,造成大表驱动小表，其实业务场景使用inner join 就可以
* join字段加上索引

#### 列表查询
使用索引覆盖，避免回表
#### 聚合查询
创建使用大宽表，使用字段冗余
> 业务场景是读多写少


### 为什么不用join
第一，不利于写操作。执行读操作时，会锁住被读的数据，阻塞其他业务对该部分数据的更新操作(U or D)。如果涉及多个聚合函数（缓存中没有max or min时），相当于同时锁住多张表，不能进行读写，直接影响其他业务，这影响了系统的整体性能；
第二，不利于维护。业务发生变动时，比如join中一张表改了，可能导致系统中原有的sql不可用，最终导致基于该SQL执行结果的上层显示失败（也意味着以往的开发工作已无效）。如果使用步骤一和步骤二的方式，只需要修改其中一个步骤就行。实际工作中，也就是只需要修改其中的一个service（对应一张表）即可。


## 优化原则

减少数据访问：设置合理的字段类型，启用压缩，通过索引访问等减少磁盘IO

返回更少的数据：只返回需要的字段和数据分页处理 减少磁盘io及网络io

减少交互次数：批量DML操作，函数存储等减少数据连接次数

减少服务器CPU开销：尽量减少数据库排序操作以及全表查询，减少cpu 内存占用

利用更多资源：使用表分区，可以增加并行操作，更大限度利用cpu资源

总结到SQL优化中，就三点:

最大化利用索引；

尽可能避免全表扫描；

减少无效数据的查询；
### in 和 exsit 的执行流程
## 资料
https://mp.weixin.qq.com/s?__biz=MzU1MzE4OTU0OQ==&mid=2247488002&idx=1&sn=130cef298442bf10404b9585f0d7768e&scene=21#wechat_redirect
[SQL优化最干货总结-MySQL(2020最新版)](https://mp.weixin.qq.com/s?__biz=MzU1MzE4OTU0OQ==&mid=2247488002&idx=1&sn=130cef298442bf10404b9585f0d7768e&scene=21#wechat_redirect)

[为什么 SQL 语句不要过多的 join？](https://blog.csdn.net/zl1zl2zl3/article/details/106661879)